
## 1. 目标检测 

**定义**：在单张图像中找到**所有**感兴趣的目标，确定它们的**类别**，并用**矩形框**把它们的位置标出来。

### 与图像分类的区别

- **图像分类 (Image Classification)**：
    
    - 输入：一张图。
    - 输出：一个标签（比如“猫”）。
    - _假设_：图里主要就这一个东西，且位于中央。
- **目标检测 (Object Detection)**：
    
    - 输入：一张图。
    - 输出：**N 个标签 + N 个位置坐标**。
    - _场景_：图里可能有 3 只猫、2 条狗和 1 辆车，它们位置各不相同。


## 2. 边界框 

在计算机视觉中，我们通常用一个矩形框来表示物体的位置，这个框就叫**边界框**。

### 2.1 坐标系

计算机图像的坐标系与数学课本里的笛卡尔坐标系不同：

- **原点 (0, 0)**：图像的**左上角**。
- **x 轴**：向**右**增加。
- **y 轴**：向**下**增加（注意：数学里通常是向上增加）。

### 2.2 两种常见的表示方法

在代码和论文中，边界框通常有两种表示方式，你需要随时能在大脑中进行转换：

#### 方法 A：对角坐标 (Corner Coordinates)

直接记录矩形的**左上角**和**右下角**坐标。

- 格式：**$[x_1, y_1, x_2, y_2]$**
    
    - $(x_1, y_1)$：左上角 (Top-Left)
    - $(x_2, y_2)$：右下角 (Bottom-Right)
- _用途_：**绘图**时常用（比如 Matplotlib 画矩形），计算 IoU（交并比）时也常用。

#### 方法 B：中心坐标 + 宽高 (Center-Size Coordinates)

记录矩形的**中心点**以及它的**宽和高**。

- 格式：**$[c_x, c_y, w, h]$**
    
    - $(c_x, c_y)$：中心点坐标
    - $w$：宽度 (Width)
    - $h$：高度 (Height)
- _用途_：**模型预测**时常用。因为模型更容易预测“偏离中心多少”和“物体有多大”。

## 3. 代码实战：两种格式的转换

在 d2l 的代码库中，你会经常看到这两个转换函数。理解它们的数学逻辑很重要。



```Python
import torch

def box_corner_to_center(boxes):
    """
    从 (x1, y1, x2, y2) 转换到 (cx, cy, w, h)
    """
    x1, y1, x2, y2 = boxes[:, 0], boxes[:, 1], boxes[:, 2], boxes[:, 3]
    
    # 宽度 = 右边 - 左边
    w = x2 - x1
    # 高度 = 下边 - 上边 (注意 y 轴向下)
    h = y2 - y1
    # 中心 x = 左边 + 宽度的一半
    cx = x1 + w / 2
    # 中心 y = 上边 + 高度的一半
    cy = y1 + h / 2
    
    return torch.stack((cx, cy, w, h), axis=-1)

def box_center_to_corner(boxes):
    """
    从 (cx, cy, w, h) 转换到 (x1, y1, x2, y2)
    """
    cx, cy, w, h = boxes[:, 0], boxes[:, 1], boxes[:, 2], boxes[:, 3]
    
    # 左上角 x1 = 中心 - 宽度的一半
    x1 = cx - 0.5 * w
    # 左上角 y1 = 中心 - 高度的一半
    y1 = cy - 0.5 * h
    # 右下角 x2 = 中心 + 宽度的一半
    x2 = cx + 0.5 * w
    # 右下角 y2 = 中心 + 高度的一半
    y2 = cy + 0.5 * h
    
    return torch.stack((x1, y1, x2, y2), axis=-1)
```

---

## 4. 真实案例演示

假设我们有一张图，里面有一只猫。

- 猫的**左上角**在像素 $(100, 100)$。
- 猫的**右下角**在像素 $(200, 200)$。

**表示 A (Corner)**: `[100, 100, 200, 200]`

**转换为表示 B (Center)**:

- $w = 200 - 100 = 100$
- $h = 200 - 100 = 100$
- $cx = 100 + 50 = 150$
- $cy = 100 + 50 = 150$
- 结果: `[150, 150, 100, 100]`


## 5. 总结

1. **目标检测**比分类更难，因为它要求模型同时输出**位置**和**类别**。
2. **边界框**是定位的核心工具。
3. 牢记 **y 轴向下** 这个反直觉的设定。
4. 熟练掌握 **(x1, y1, x2, y2)** 和 **(cx, cy, w, h)** 之间的互换。



